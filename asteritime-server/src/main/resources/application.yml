spring:
  application:
    name: asteritime-server
  
  datasource:
    url: jdbc:mysql://localhost:3306/asteritime?useSSL=false&serverTimezone=UTC&characterEncoding=UTF-8&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
    # HikariCP 连接池配置（支持多线程并发）
    hikari:
      # 连接池最小空闲连接数
      minimum-idle: 5
      # 连接池最大连接数（根据服务器性能调整，建议为CPU核心数 * 2 + 磁盘数）
      maximum-pool-size: 20
      # 连接超时时间（毫秒）
      connection-timeout: 30000
      # 连接最大空闲时间（毫秒），超过此时间未使用的连接将被释放
      idle-timeout: 600000
      # 连接最大生命周期（毫秒），超过此时间的连接将被关闭并重新创建
      max-lifetime: 1800000
      # 连接池名称（用于监控）
      pool-name: AsteriTimeHikariCP
      # 是否自动提交（默认true，建议保持true）
      auto-commit: true
      # 连接泄漏检测（毫秒），0表示禁用
      leak-detection-threshold: 60000
  
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
        # 事务隔离级别：READ_COMMITTED（读已提交，防止脏读）
        # 可选值：READ_UNCOMMITTED, READ_COMMITTED, REPEATABLE_READ, SERIALIZABLE
        connection:
          isolation: 2  # 2 = READ_COMMITTED
        # 启用二级缓存（可选，用于提高性能）
        # cache:
        #   use_second_level_cache: true
        #   use_query_cache: true

server:
  port: 8080
  servlet:
    context-path: /api
    # Tomcat 线程池配置（支持多线程处理连接）
    threads:
      # 最大工作线程数（处理请求的线程数）
      max: 200
      # 最小工作线程数
      min-spare: 10
    # Tomcat 连接器配置
    tomcat:
      # 最大连接数（同时处理的连接数）
      max-connections: 10000
      # 接受连接的线程数
      accept-count: 100
      # 连接超时时间（毫秒）
      connection-timeout: 20000
      # 是否启用压缩
      compression: on
      # 压缩的最小大小（字节）
      compressible-mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json

logging:
  level:
    com.asteritime: DEBUG
    org.springframework.web: INFO

# JWT 配置（从环境变量读取，默认值仅用于开发环境）
jwt:
  secret: ${JWT_SECRET:AsteriTimeSecretKeyForJWTTokenGeneration2025ThisShouldBeLongEnough}
  expiration: ${JWT_EXPIRATION:604800000}  # 7天（毫秒）


