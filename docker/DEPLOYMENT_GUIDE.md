# AsteriTime å®¹å™¨åŒ–éƒ¨ç½²å¿«é€ŸæŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

1. **å®‰è£… Docker**
   ```bash
   # macOS
   brew install --cask docker
   
   # Linux (Ubuntu/Debian)
   sudo apt-get update
   sudo apt-get install docker.io docker-compose
   
   # å¯åŠ¨ Docker Desktop (macOS) æˆ– Docker æœåŠ¡ (Linux)
   ```

2. **éªŒè¯ Docker å®‰è£…**
   ```bash
   docker --version
   docker-compose --version
   ```

## ğŸš€ å®¹å™¨åŒ–æ­¥éª¤

### æ­¥éª¤ 1: è¿›å…¥ docker ç›®å½•

```bash
cd /Users/huangxucheng/Desktop/JavaFinal/docker
```

### æ­¥éª¤ 2: åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

```bash
# å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œé»˜è®¤å€¼å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼‰
# macOS/Linux
nano .env
# æˆ–
vim .env
```

**è¯´æ˜**ï¼š
- é»˜è®¤é…ç½®å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ˆç”¨äºæµ‹è¯•ï¼‰
- ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹å¯†ç å’Œ JWT_SECRET

### æ­¥éª¤ 3: æ„å»º Docker é•œåƒ

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
chmod +x *.sh

# æ„å»ºæ‰€æœ‰é•œåƒï¼ˆMySQLã€åç«¯ã€å‰ç«¯ï¼‰
./docker-build.sh
```

**è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ**ï¼Œå› ä¸ºéœ€è¦ï¼š
- ä¸‹è½½ MySQL é•œåƒ
- æ„å»ºåç«¯é•œåƒï¼ˆç¼–è¯‘ Java ä»£ç ï¼‰
- æ„å»ºå‰ç«¯é•œåƒï¼ˆå®‰è£… npm ä¾èµ–å¹¶æ„å»º React åº”ç”¨ï¼‰

### æ­¥éª¤ 4: å¯åŠ¨æœåŠ¡

```bash
# åå°å¯åŠ¨æ‰€æœ‰æœåŠ¡
./docker-deploy.sh
```

**ç­‰å¾…æœåŠ¡å¯åŠ¨**ï¼ˆå¤§çº¦ 30-60 ç§’ï¼‰ï¼Œä½ ä¼šçœ‹åˆ°ï¼š
- âœ… MySQL å·²å°±ç»ª
- âœ… åç«¯å·²å°±ç»ª
- âœ… å‰ç«¯å·²å°±ç»ª

### æ­¥éª¤ 5: éªŒè¯éƒ¨ç½²

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- **å‰ç«¯åº”ç”¨**: http://localhost:80
- **åç«¯ API**: http://localhost:8080/api/auth/login

## ğŸ“ å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
./docker-logs.sh

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
./docker-logs.sh backend
./docker-logs.sh frontend
./docker-logs.sh mysql

# æŸ¥çœ‹æœ€å100è¡Œæ—¥å¿—ï¼ˆä¸è·Ÿè¸ªï¼‰
./docker-logs.sh --tail 100
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢æœåŠ¡ï¼ˆä¿ç•™å®¹å™¨å’Œæ•°æ®ï¼‰
./docker-stop.sh

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
./docker-stop.sh -r

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨å’Œæ•°æ®å·ï¼ˆâš ï¸ ä¼šåˆ é™¤æ•°æ®åº“æ•°æ®ï¼ï¼‰
./docker-stop.sh -v
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend
docker-compose restart frontend
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :80
lsof -i :8080
lsof -i :3306

# ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ç«¯å£é…ç½®
FRONTEND_PORT=8081
BACKEND_PORT=8081
```

### é—®é¢˜ 2: æ„å»ºå¤±è´¥

```bash
# æ¸…ç† Docker ç¼“å­˜
docker system prune -a

# å¼ºåˆ¶é‡æ–°æ„å»º
./docker-deploy.sh --rebuild
```

### é—®é¢˜ 3: æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./docker-logs.sh

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ç‰¹å®šå®¹å™¨æ—¥å¿—
docker-compose logs backend
docker-compose logs frontend
docker-compose logs mysql
```

### é—®é¢˜ 4: æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ MySQL å®¹å™¨æ˜¯å¦è¿è¡Œ
docker-compose ps mysql

# è¿›å…¥ MySQL å®¹å™¨æ£€æŸ¥
docker-compose exec mysql mysql -u root -p

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env
```

## ğŸ“Š æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨è®¿é—® http://localhost:80         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (Nginx + React)               â”‚
â”‚  Port: 80                                â”‚
â”‚  å®¹å™¨å: asteritime-frontend             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ /api è¯·æ±‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (Spring Boot)                   â”‚
â”‚  Port: 8080                              â”‚
â”‚  å®¹å™¨å: asteritime-backend              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ JDBC
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL 8.0                               â”‚
â”‚  Port: 3306                              â”‚
â”‚  å®¹å™¨å: asteritime-mysql                â”‚
â”‚  æ•°æ®å·: mysql_data                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ›´æ–°åº”ç”¨

```bash
# 1. åœæ­¢æœåŠ¡
./docker-stop.sh

# 2. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœæœ‰ï¼‰
cd ..
git pull
cd docker

# 3. é‡æ–°æ„å»ºå¹¶å¯åŠ¨
./docker-deploy.sh --rebuild
```

## ğŸ’¾ æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec mysql mysqldump -u root -p${MYSQL_ROOT_PASSWORD} asteritime > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T mysql mysql -u root -p${MYSQL_ROOT_PASSWORD} asteritime < backup_20250101.sql
```

## ğŸ¯ ä¸‹ä¸€æ­¥

å®¹å™¨åŒ–å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. **æµ‹è¯•åŠŸèƒ½**ï¼šè®¿é—® http://localhost:80 æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. **é…ç½®ç”Ÿäº§ç¯å¢ƒ**ï¼šä¿®æ”¹ `.env` ä¸­çš„å¯†ç å’Œå¯†é’¥
3. **éƒ¨ç½²åˆ°æœåŠ¡å™¨**ï¼šå°†æ•´ä¸ªé¡¹ç›®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨
4. **é…ç½®åŸŸåå’Œ HTTPS**ï¼šä½¿ç”¨ Nginx åå‘ä»£ç†é…ç½®åŸŸå

## ğŸ“š æ›´å¤šä¿¡æ¯

- è¯¦ç»†æ–‡æ¡£ï¼š`docker/README.md`
- GCP éƒ¨ç½²ï¼š`docs/GCP_DEPLOYMENT.md`
- é¡¹ç›®ä¸»æ–‡æ¡£ï¼š`README.md`

